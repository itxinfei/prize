# 红包雨

### 一、介绍

1、企业年会之红包雨场景实战

假设公司要开年会，让你设计一套红包雨项目，在某段时间内随机发放不同的礼品，你该如何设计呢？本项目实现了一个完整的红包雨模式抽奖系统，包括管理后台与前端界面。该项目由管理后台配置相关活动和奖品等信息，前端用户通过参与活动，完成抽奖。

​	1)电商活动

​		互联网的发展中，电商是典型的应用场景。电商，即买卖，就比如要抓住消费者的心理。那么各种促销、活动、成为电商公司必备的业务模块，尤其C端业务，面向普通大众用户。在所有活动中，抽奖是最典型的一种。

​	2)红包雨

​	阿里春节的红包雨大家都多有参与。很多公司争相模仿，以实现随机派发红包的形式完成宣传与促销。红包雨可以理解为抽奖的一种特殊形式，奖品即红包。

​	3)企业年会

​	年会基本是每个公司绕不开的话题。公司年会中的抽奖环节更是必不可少。尤其互联网公司，线上抽奖基本成为大家约定俗成的形式。打开手机，参与抽奖。正是本项目所涉及的现实应用场景。

 #####  2、系统要求

​	1)并发性

​		抽奖系统比如涉及到访问量大的问题。系统涉及所面临的第一关，即活动开始的瞬间，大批用户点击的涌入。怎样设计系统以达到如此高并发情况下的及时响应是本项目的重中之重。

​	2)库存控制

​		抽奖面临的必然是奖品。数量控制是必须要做到精准吻合。不允许出现设置了5个奖品，最终6人中奖这种类似的问题出现。其中的本质是奖品库存的控制。后续的章节中会详细介绍本项目中如何做到控制库存的。

​	3)投放策略

​		在活动时间段内，管理员设置好的一堆奖品如何投放？红包何时出现？年会奖品什么时候可以被抽中？这些都涉及到投放策略。本项目中会给大家展示最常见的一种策略，即在活动时间内，奖品随机出现。最后的课程会给出引申，如何灵活扩展实现其他的投放算法。

​	4)边界控制

​		活动何时开始？何时结束？倒计时如何控制。这涉及到活动的边界。开始前要提防用户提前进入抽奖。结束后要即使反馈结果给用户，告知活动已结束。

​	5)活动自由配置

​		活动的配置由后台管理员完成，可以自由配置活动的开始结束时间，主题、活动简介、有哪些奖品、不同等级的用户中奖的策略，这就要求系统必须具备足够的业务灵活度。

​	6)中奖策略

​		每个用户参与抽奖后，要遵从后台管理员所设定的中奖策略，典型的场景是针对用户设置最大中奖数。一旦用户中奖后，要进入计数，达到最大中奖数后，即使活动未结束，用户继续参与，也不能再让其中奖。而是将奖品机会倾向于其他参与者，后面中会为大家展示如何根据后台策略精确控制用户中奖数量。

### 二、后台管理backend

1.   下载backend项目，并导入idea中

2.   导入resources下的sql到数据库中，并在pom文件的profile中配置数据库信息

   (导入时会有几个视图无法创建，可以直接复制sql文件的视图语句到数据库中直接创建即可)

3.   启动

4.   http://localhost:8888

#### zkui zookeeper的ui界面
    1、在config.cfg中配置地址zkServer(根据自己的实际情况)
    2、serverPort为ui界面访问端口,默认是 localhost:9090
    3、修改配置后,更新配置到zkui.jar文件中, 使用命令: jar uvf zkui.jar config.cfg
    4、运行: java -jar zkui.ar
